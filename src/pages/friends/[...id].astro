---
import AuthorCard from '@/components/AuthorCard.astro'
import Breadcrumbs from '@/components/Breadcrumbs.astro'
import PageHead from '@/components/PageHead.astro'
import Layout from '@/layouts/Layout.astro'
import { getAllAuthors } from '@/lib/data-utils'
import { fetchRSSFeed } from '@/lib/rss-utils'
export async function getStaticPaths() {
  const friends = await getAllAuthors()
  return friends.map((friend) => ({
    params: { id: friend.id },
    props: { friend },
  }))
}
import '@fontsource/lxgw-wenkai';
const { friend } = Astro.props
const rssItems = friend.data.rss ? await fetchRSSFeed(friend.data.rss) : []
---

<Layout class="max-w-3xl">
  <PageHead
    slot="head"
    title={`${friend.data.name} - 文章列表`}
    description={friend.data.bio || `Profile of ${friend.data.name}.`}
    noindex
  />
  <Breadcrumbs
    items={[
      { href: '/friends', label: '友情链接', icon: 'lucide:users' },
      { label: friend.data.name, icon: 'lucide:user' },
    ]}
  />

  <section>
    <AuthorCard friend={friend} />
  </section>
  
  {rssItems.length > 0 && (
    <section class="flex flex-col gap-y-4">
      <h2 class="text-2xl font-medium">{friend.data.name}的最新文章</h2>
      <ul class="flex flex-col gap-3">
        {rssItems.slice(0, 5).map((item) => (
          <li class="border-l-2 border-primary/20 pl-4">
            <a 
              href={item.link} 
              target="_blank" 
              rel="noopener noreferrer"
              class="block hover:text-primary transition-colors"
            >
              <h3 class="font-medium text-sm md:text-base line-clamp-2">{item.title}</h3>
              <time class="text-xs text-muted-foreground">
                {item.pubDate.toLocaleDateString()}
              </time>
              {item.description && (
                <p class="text-xs text-muted-foreground mt-1 line-clamp-2">
                  {item.description.replace(/<[^>]*>/g, '').slice(0, 120)}...
                </p>
              )}
            </a>
          </li>
        ))}
      </ul>
    </section>
  )}
</Layout>
